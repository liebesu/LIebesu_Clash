# 🚀 全局节点测速功能使用指南

## 📋 功能概述

**全局节点测速**是LIebesu_Clash的一项强大功能，可以同时测试所有订阅中的节点，找出最优的代理节点。该功能支持直连测试、智能排序、流量信息显示等多项特性。

## ✨ 核心特性

### 🌍 全面覆盖
- ✅ **多订阅支持**: 测试所有有效订阅中的节点
- ✅ **直连测试**: 不通过代理，直接测试节点服务器连通性
- ✅ **批量并发**: 高效的批量测试，每批8个节点并发处理
- ✅ **智能跳过**: 自动跳过系统配置项（Script、Merge等）

### 📊 丰富信息
- 🌏 **地理位置识别**: 自动识别节点地区（香港、台湾、新加坡、日本、美国等11个地区）
- 📶 **延迟测试**: 多次测试取平均值，确保准确性
- 🚀 **速度估算**: 基于延迟的智能速度估算
- 📊 **稳定性评分**: 综合评分系统
- 💾 **流量信息**: 显示订阅剩余流量和到期时间（支持模拟和真实数据）

### 🎯 智能排序
- 🏆 **综合评分**: 延迟(40%) + 速度(40%) + 稳定性(20%)的综合排名
- 📈 **多维度排序**: 支持按延迟、速度、稳定性等维度排序
- 🔢 **灵活显示**: 支持Top 10显示和全量结果切换

## 🔧 使用方法

### 1️⃣ 启动测速
1. 在主界面的**订阅页面**中，找到**全局测速**按钮
2. 点击**"开始全局测速"**按钮
3. 系统将自动开始测试所有订阅中的节点

### 2️⃣ 查看进度
测速过程中，您可以看到：
- 📊 **实时进度条**: 显示测试进度百分比
- 🔄 **当前节点**: 显示正在测试的节点信息
- ⏱️ **预估时间**: 显示预计剩余时间
- 📈 **批次信息**: 显示当前批次和总批次数

### 3️⃣ 查看结果
测速完成后，您将看到：

#### 📊 结果摘要
- **总节点数**: 发现的所有节点数量
- **成功测试**: 测试成功的节点数量
- **失败测试**: 测试失败的节点数量
- **总耗时**: 完整测速所用时间

#### 🏆 最佳节点推荐
系统会自动推荐综合评分最高的节点，显示：
- 节点名称和服务器信息
- 所属订阅和地理位置
- 延迟、速度、稳定性数据

#### 📋 详细排名表格
包含以下信息：
- **排名**: 按综合评分排序
- **节点名称**: 节点的显示名称
- **服务器地址**: 节点的实际服务器地址
- **类型**: 节点协议类型（SS、SSR、Trojan、VMess等）
- **订阅**: 节点所属的订阅名称
- **地区**: 自动识别的地理位置
- **延迟**: 直连延迟（颜色编码）
- **下载/上传速度**: 估算的网络速度（颜色编码）
- **稳定性**: 稳定性评分（0-100分）
- **剩余流量**: 订阅流量使用情况
- **状态**: 测试成功/失败状态

### 4️⃣ 切换节点
- 点击**"切换到最佳节点"**按钮，系统将自动切换到评分最高的节点
- 也可以手动记录优秀节点信息，在订阅管理中手动切换

### 5️⃣ 结果分析
- **Top 10 / 全部结果切换**: 可以在前10名和所有结果之间切换显示
- **颜色编码说明**: 
  - **绿色**: 优秀（延迟≤50ms，速度≥100Mbps，稳定性≥90分）
  - **橙色**: 良好（延迟≤200ms，速度≥20Mbps，稳定性≥70分）
  - **黄色**: 一般（延迟≤500ms，速度≥5Mbps，稳定性≥50分）
  - **红色**: 较差（超出上述范围）

## 📝 技术说明

### 🔍 测试原理
1. **节点发现**: 遍历所有订阅配置，解析YAML/JSON格式的节点信息
2. **直连测试**: 使用TCP连接直接测试节点服务器的可达性
3. **多次采样**: 每个节点测试3次，取平均值确保准确性
4. **批量处理**: 每批8个节点并发测试，平衡性能和资源使用

### ⚡ 性能优化
- **智能超时**: 单节点测试最长10秒，批次测试最长60秒
- **资源管理**: 及时释放网络连接，避免资源泄漏
- **批次间隔**: 批次间200ms休息时间，避免网络拥塞
- **随机延迟**: 同批次内随机100-200ms延迟，提高成功率

### 📊 评分算法
```
综合评分 = 延迟评分(40%) + 速度评分(40%) + 稳定性评分(20%)

延迟评分 = max(0, (500ms - 实际延迟ms) / 500ms) × 40分
速度评分 = min(1, 估算速度Mbps / 100Mbps) × 40分
稳定性评分 = 稳定性分数 × 0.2分
```

## 🔧 故障排除

### ❓ 常见问题

**Q: 为什么某些节点测试失败？**
A: 可能原因包括：
- 节点服务器离线或不可达
- 网络防火墙阻止连接
- 节点配置信息不正确
- DNS解析失败

**Q: 测速结果是否准确？**
A: 测速结果基于直连TCP连接延迟，可以准确反映节点的连通性和基础性能。速度数据是基于延迟的估算，实际使用速度可能会有差异。

**Q: 为什么没有显示流量信息？**
A: 流量信息需要订阅服务商在HTTP响应头中提供相关数据。目前支持模拟数据展示，真实数据需要在订阅更新时获取。

**Q: 测速很慢怎么办？**
A: 测速时间取决于：
- 节点数量（每批8个，总时间 ≈ 节点数量 ÷ 8 × 15秒）
- 网络状况
- 节点响应速度
建议在网络状况良好时进行测速。

### 🔧 优化建议

1. **定期测速**: 建议每周进行一次全局测速，获取最新的节点性能数据
2. **网络环境**: 在网络状况良好的时候进行测速，确保结果准确性
3. **订阅管理**: 及时清理失效订阅，减少测速时间
4. **结果参考**: 综合考虑延迟、速度、地理位置选择最适合的节点

## 🎯 使用技巧

1. **批量测试**: 适合有多个订阅、需要快速找到最优节点的场景
2. **性能对比**: 可以对比不同订阅服务商的节点质量
3. **地区选择**: 根据访问需求选择合适地区的节点
4. **定期监控**: 结合测速结果和实际使用体验，优化代理策略

---

**注意**: 此功能进行的是基础连通性测试，实际使用速度还受到代理协议、加密方式、服务商带宽等多种因素影响。建议结合测速结果和实际使用体验来选择最佳节点。

